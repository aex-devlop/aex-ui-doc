(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{348:function(n,e,t){"use strict";t.r(e);var s=[function(){var n=this,e=n.$createElement,e=n._self._c||e;return e("section",{staticClass:"content aex-doc"},[e("h1",[n._v("Firebase第三方登录（google）")]),e("div",{staticClass:"tip"},[e("p",[n._v("资料整理: 付永顺"),e("br"),n._v("\n更新日期: 2022-03-01")])]),e("p",[e("strong",[n._v("网址")]),n._v("：https://firebase.google.com")]),e("p",[e("strong",[n._v("准备")]),n._v("：需公司申请一个firebase账号，相应的开发人员开通相应权限\n"),e("strong",[n._v("要求")]),n._v("：开发此项目必须开启VPN")]),e("p",[n._v("参考文档：https://firebase.google.com/docs/auth/web/google-signin?authuser=0")]),e("h4",[n._v("步骤一：创建项目")]),e("p",[e("img",{attrs:{src:t(393),alt:"1642474884087"}})]),e("h4",[n._v("步骤二：添加对应应用")]),e("p",[e("img",{attrs:{src:t(394),alt:"1642475633377"}})]),e("p",[n._v("完成后点开相应的设置，即可看到详细信息和配置（根据需要npm安装或CDN引入）")]),e("p",[e("img",{attrs:{src:t(395),alt:"1642475948161"}})]),e("h4",[n._v("步骤三：设置第三方授权登录信息")]),e("p",[e("img",{attrs:{src:t(396),alt:"1642476383456"}})]),e("h4",[n._v("步骤四：js项目中使用")]),e("p",[n._v("js中安装firebse")]),e("pre",[e("code",{staticClass:"language-javascript"},[n._v("yarn add firebase\n")])]),e("p",[n._v("项目中导入")]),e("pre",[e("code",{staticClass:"language-javascript"},[n._v("import {\n    initializeApp\n} from 'firebase/app';\n//基本配置和添加应用生成的配置保持一致\nconst firebaseConfig = {\n    apiKey: 'AIzaSyAw1ksogZT8qxk1lanacGsdJm9CkTB9OcY',\n    authDomain: 'causal-bindery-334409.firebaseapp.com',\n    projectId: 'causal-bindery-334409',\n    storageBucket: 'causal-bindery-334409.appspot.com',\n    messagingSenderId: '559420313769',\n    appId: '1:559420313769:web:6b5f50e8e02845a010d9b8',\n    measurementId: 'G-S8W5K9JVLQ'\n};\n// 初始化 Firebase\nconst app = initializeApp(firebaseConfig);\nconst analytics = getAnalytics(app);\n//创建 Google 提供方对象实例(signInWithPopup,signInWithRedirect使用弹窗或者使用从定向)\nimport {\n    getAuth,\n    signInWithPopup,\n    GoogleAuthProvider\n} from 'firebase/auth';\nconst auth = getAuth();\nconst provider = new GoogleAuthProvider();\n")])]),e("pre",[e("code",{staticClass:"language-javascript"},[n._v("// 第三方谷歌登录\ngoogleLogin() {\n    signInWithPopup(auth, provider)\n        .then((result) => {\n            //result有用户的信息，根据后端要求拿需要的，如果是弹窗,授权成功会自动关闭弹窗\n            //这里处理你需要的逻辑\n        })\n        .catch((error) => {\n            //可处理授权失败后的逻辑\n            console.log(error, '错误信息');\n        });\n},\n")])]),e("p",[e("strong",[n._v("可能出现的问题：")])]),e("p",[n._v("问题一：无法唤起第三方登录弹窗？")]),e("p",[n._v("原因：网络请求报错，拿不到步骤三设置的白名单网域(重新检查配置、VPN不稳定等）、环境问题和运维沟通")]),e("pre",[e("code",{staticClass:"language-javascript"},[n._v('{\n    "projectId": "559420313769",\n    "authorizedDomains": [\n        "localhost",\n        "causal-bindery-334409.firebaseapp.com",\n        "causal-bindery-334409.web.app",\n        "www.test_auth_login.cc",\n        "www.aextest.cc",\n        "www.aex.cash",\n        "aex1.yxds.net.cn",\n        "www.aex.com"\n    ]\n}\n')])]),e("p",[n._v("问题二：正式环境无法弹起")]),e("p",[n._v("原因：可能需要运维将https://apis.google.com、https://identitytoolkit.googleapis.com、https://www.googleapis.com等添加到Content-Security-Policy(csp)，具体看报错")]),e("p",[e("strong",[n._v("优化问题：")])]),e("p",[e("code",[n._v("这不是bug，只是浏览器的特性，能处理的是第三方的退出和登录。如第三方每次登陆需要输入密码和账户的话，那第三方登录就没啥意义了，只是阐述有这么个问题存在，不是设置了没效果")])]),e("p",[n._v("问题三：第一次授权登录后，会自动记录Google账号，不能切换谷歌账号（除非手动清除浏览器缓存）")]),e("p",[n._v("原因：授权登录后，谷歌浏览器会自动授权登录google账号，其他浏览器也记录了账户和密码")]),e("p",[e("strong",[n._v("代码优化（两种方式）")])]),e("p",[n._v("方式一：firebase中的signOut方法")]),e("pre",[e("code",{staticClass:"language-js"},[n._v('import {\n    getAuth,\n    signOut\n} from "firebase/auth";\n\nconst auth = getAuth();\n\nsignOut(auth).then(() => {\n\n    //这里写退出登录后的逻辑处理\n\n    // Sign-out successful.\n\n}).catch((error) => {\n\n    // An error happened.\n\n});\n')])]),e("p",[n._v("方式二：修改firebase身份验证状态保留方式, firebase里面有三种Auth状态保留(local、session、none)，上述情况是默认的local保留, 现在改为session(以signInWithPopup为例)")]),e("p",[n._v("网址：https://firebase.google.com/docs/auth/web/auth-state-persistence?authuser=0")]),e("pre",[e("code",{staticClass:"language-js"},[n._v('import {\n    getAuth,\n    setPersistence,\n    signInWithPopup,\n    browserSessionPersistence\n} from "firebase/auth";\n\nconst auth = getAuth();\n\n//browserSessionPersistence改为session固定写法\n\nsetPersistence(auth, browserSessionPersistence)\n\n    .then(() => {\n\n        //return signInWithEmailAndPassword(auth, email, password);\n\n        //return signInWithRedirect(auth, provider);\n\n        return signInWithPopup(auth, provider) //根据你使用的方式进行修改,对应上述的导入方式\n\n    })\n\n    .catch((error) => {\n\n        const errorCode = error.code;\n\n        const errorMessage = error.message;\n\n    });\n')])]),e("p",[n._v("完整代码")]),e("pre",[e("code",{staticClass:"language-js"},[n._v("// 第三方谷歌登录\ngoogleLogin() {\n    signOut(auth).then(() => {\n        setPersistence(auth, browserSessionPersistence)\n            .then(() => {\n                return signInWithPopup(auth, provider)\n                    .then((result) => {\n                        console.log(result, '用户信息');\n                    })\n                    .catch((error) => {\n                        console.log(error, '错误信息');\n                    });\n            })\n            .catch((error) => {\n                // Handle Errors here.\n                const errorCode = error.code;\n                const errorMessage = error.message;\n            });\n    });\n},\n")])]),e("p",[e("strong",[n._v("非代码处理（针对浏览器）")])]),e("p",[n._v("谷歌：进行谷歌授权登录后，谷歌浏览器会自动授权登录谷歌账号，手动退出浏览器的谷歌账号即可")]),e("p",[n._v("非谷歌+谷歌：在浏览器设置中不勾选记录账号和密码即可")]),e("p",[n._v("后续有补充再添加...")])])}],r=t(0),s=Object(r.a)({},function(){var n=this,e=n.$createElement;n._self._c;return n._m(0)},s,!1,null,null,null);e.default=s.exports},393:function(n,e,t){n.exports=t.p+"static/1.8e964e3.png"},394:function(n,e,t){n.exports=t.p+"static/2.dda2d0c.png"},395:function(n,e,t){n.exports=t.p+"static/3.f1c9053.png"},396:function(n,e,t){n.exports=t.p+"static/4.d8dc22a.png"}}]);